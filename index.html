<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Proje Yönetimi</title>
  <script type="module">
    // Firebase importları
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // Firebase config (kendi bilgilerinle güncelle)
    const firebaseConfig = {
        apiKey: "AIzaSyCxwXtrXxHbC_LcIlbK_PRIQ4v5pXt1l6w",
        authDomain: "atolye1886projectmanagement.firebaseapp.com",
        databaseURL: "https://atolye1886projectmanagement-default-rtdb.firebaseio.com",
        projectId: "atolye1886projectmanagement",
        storageBucket: "atolye1886projectmanagement.firebasestorage.app",
        messagingSenderId: "852948318375",
        appId: "1:852948318375:web:609dd6544580d7d6430382"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Rastgele renkli avatar oluşturma
    function getRandomColor() {
      const colors = ["#e74c3c","#3498db","#2ecc71","#9b59b6","#f39c12","#1abc9c","#e67e22"];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    // Proje Kaydet
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("projectForm").addEventListener("submit", (e) => {
        e.preventDefault();

        const yeniProje = {
          baslik: document.getElementById("baslik").value || "—",
          aciklama: document.getElementById("aciklama").value || "—",
          tur: document.getElementById("tur").value || "—",
          baslangic: document.getElementById("baslangic").value || "—",
          bitis: document.getElementById("bitis").value || "—",
          teklif: document.getElementById("teklif").value || "—",
          fatura: document.getElementById("fatura").value || "—",
          satinAlma: document.getElementById("satinAlma").value || "—",
          notlar: document.getElementById("notlar").value || "—",
          ekleyen: document.getElementById("ekleyen").value || "Anonim",
          renk: getRandomColor()
        };

        const newRef = push(ref(db, "projects"));
        set(newRef, yeniProje);
        document.getElementById("projectForm").reset();
      });

      loadProjects();
    });

    // Proje Sil
    function deleteProject(id) {
      if (confirm("Bu projeyi silmek istediğinize emin misiniz?")) {
        remove(ref(db, "projects/" + id));
      }
    }
    window.deleteProject = deleteProject;

    // Projeleri Listele
    function loadProjects() {
      const container = document.getElementById("projectsContainer");
      onValue(ref(db, "projects"), (snapshot) => {
        container.innerHTML = "";
        const projects = snapshot.val();

        if (!projects) {
          container.innerHTML = "<p>Henüz proje eklenmedi.</p>";
          return;
        }

        // Tarihe göre sıralayalım
        const sorted = Object.entries(projects).sort((a,b) => {
          const tarihA = new Date(a[1].baslangic || "2100-01-01");
          const tarihB = new Date(b[1].baslangic || "2100-01-01");
          return tarihB - tarihA;
        });

        let currentMonth = "";

        sorted.forEach(([id, p]) => {
          const baslangic = p.baslangic || "—";
          const bitis = p.bitis || "—";
          const ay = baslangic !== "—" ? new Date(baslangic).toLocaleString("tr-TR",{month:"long",year:"numeric"}) : "Tarih Belirsiz";

          if (ay !== currentMonth) {
            currentMonth = ay;
            container.innerHTML += `<h2 style="margin-top:20px">${ay}</h2>`;
          }

          container.innerHTML += `
            <div class="card">
              <div class="avatar" style="background:${p.renk || "#ccc"}">
                ${p.ekleyen ? p.ekleyen[0].toUpperCase() : "?"}
              </div>
              <div class="card-content">
                <h3>${p.baslik || "—"}</h3>
                <p><strong>Tür:</strong> ${p.tur || "—"}</p>
                <p><strong>Başlangıç:</strong> ${baslangic}</p>
                <p><strong>Bitiş:</strong> ${bitis}</p>
                <details>
                  <summary>Daha Fazla</summary>
                  <p><strong>Açıklama:</strong> ${p.aciklama || "—"}</p>
                  <p><strong>Teklif:</strong> <a href="${p.teklif}" target="_blank">${p.teklif}</a></p>
                  <p><strong>Fatura:</strong> <a href="${p.fatura}" target="_blank">${p.fatura}</a></p>
                  <p><strong>Satın Alma:</strong> ${p.satinAlma || "—"}</p>
                  <p><strong>Notlar:</strong> ${p.notlar || "—"}</p>
                  <p><em>Ekleyen: ${p.ekleyen || "Anonim"}</em></p>
                </details>
              </div>
              <button class="delete-btn" onclick="deleteProject('${id}')">🗑️</button>
            </div>
          `;
        });
      });
    }
  </script>

  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
    h1 { text-align: center; }
    form { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
    label { display:block; margin-top:10px; }
    input, textarea, select { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:4px;}
    button { padding:8px 12px; border:none; border-radius:5px; cursor:pointer;}
    .card { background:#fff; margin:10px 0; padding:10px; border-radius:8px; display:flex; align-items:flex-start; gap:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
    .card-content { flex:1; }
    .delete-btn { background:#e74c3c; color:#fff; }
    .avatar { width:40px; height:40px; border-radius:50%; color:#fff; display:flex; align-items:center; justify-content:center; font-weight:bold; }
  </style>
</head>
<body>
    <h1><img src="logo.png" alt="" style="float:left;">📌 Proje Takip Sistemi</h1>

  <form id="projectForm">
    <label>Proje Başlığı</label>
    <input id="baslik" required>

    <label>Proje Türü</label>
    <select id="tur">
      <option value="3D Tasarım">3D Tasarım</option>
      <option value="Tersine Mühendislik">Tersine Mühendislik</option>
      <option value="Prototipleme">Prototipleme</option>
    </select>

    <label>Açıklama</label>
    <textarea id="aciklama"></textarea>

    <label>Başlangıç Tarihi</label>
    <input type="date" id="baslangic">

    <label>Bitiş Tarihi</label>
    <input type="date" id="bitis">

    <label>Teklif Linki</label>
    <input type="url" id="teklif">

    <label>Fatura Linki</label>
    <input type="url" id="fatura">

    <label>Satın Alma Bilgisi</label>
    <input id="satinAlma">

    <label>Notlar</label>
    <textarea id="notlar"></textarea>

    <label>Ekleyen Kişi</label>
    <input id="ekleyen">

    <button type="submit">Kaydet</button>
  </form>

  <div id="projectsContainer"></div>
</body>
</html>


