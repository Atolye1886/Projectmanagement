<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Proje Takip Sistemi</title>
  <style>
    body { font-family: Arial, sans-serif; margin:20px; background:#f4f4f9; }
    h1 { text-align:center; }
    form { background:#fff; padding:15px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); margin-bottom:20px; }
    label { display:block; margin-top:10px; }
    input, select, textarea { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:5px; }
    button { margin-top:15px; padding:10px 15px; border:none; border-radius:5px; background:#007bff; color:#fff; cursor:pointer; }
    button:hover { background:#0056b3; }
    .month-group { margin-bottom:30px; }
    .cards { display:flex; flex-wrap:wrap; gap:15px; }
    .card { background:#fff; padding:15px; border-radius:10px; width:300px; box-shadow:0 2px 5px rgba(0,0,0,0.15); cursor:pointer; }
    .profile { display:flex; align-items:center; margin-top:10px; }
    .avatar { width:28px; height:28px; border-radius:50%; margin-right:8px; flex-shrink:0; }
    .details { display:none; margin-top:10px; padding-top:10px; border-top:1px solid #ddd; }
    .notes { margin-top:10px; }
    .note { background:#f9f9f9; padding:6px; border-radius:5px; margin-top:5px; font-size:0.9em; }
    .sidebar { position:fixed; right:10px; top:10px; width:200px; background:#fff; border:1px solid #ccc; border-radius:8px; padding:10px; max-height:90vh; overflow:auto; }
    .sidebar h3 { margin-top:0; }
  </style>
</head>
<body>

  <h1>ðŸ“Œ Proje Takip Sistemi</h1>

  <!-- Proje Ekleme Formu -->
  <form id="projectForm">
    <label>Proje AdÄ±</label>
    <input type="text" id="title" required>

    <label>Proje TÃ¼rÃ¼</label>
    <select id="type" required>
      <option value="3D TasarÄ±m">3D TasarÄ±m</option>
      <option value="Tersine MÃ¼hendislik">Tersine MÃ¼hendislik</option>
      <option value="Prototipleme">Prototipleme</option>
    </select>

    <label>Proje Ã–zeti</label>
    <textarea id="summary" rows="2"></textarea>

    <label>BaÅŸlangÄ±Ã§ Tarihi</label>
    <input type="date" id="startDate" required>

    <label>BitiÅŸ Tarihi</label>
    <input type="date" id="endDate">

    <label>Teklif Linki</label>
    <input type="url" id="offer">

    <label>Fatura Linki</label>
    <input type="url" id="invoice">

    <label>SatÄ±n Alma Bilgisi</label>
    <input type="text" id="purchase">

    <label>GiriÅŸi Yapan KiÅŸi</label>
    <input type="text" id="author" required>

    <button type="submit">âž• Proje Ekle</button>
  </form>

  <!-- Projeler -->
  <div id="projects"></div>

  <!-- Biten / Beklemede Sidebar -->
  <div class="sidebar">
    <h3>ðŸ“‚ Tamamlanan / Beklemede</h3>
    <div id="archive"></div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    // ðŸ”¹ Firebase Config (kendi bilgilerini yapÄ±ÅŸtÄ±r)
    const firebaseConfig = {
        apiKey: "AIzaSyCxwXtrXxHbC_LcIlbK_PRIQ4v5pXt1l6w",
        authDomain: "atolye1886projectmanagement.firebaseapp.com",
        databaseURL: "https://atolye1886projectmanagement-default-rtdb.firebaseio.com",
        projectId: "atolye1886projectmanagement",
        storageBucket: "atolye1886projectmanagement.firebasestorage.app",
        messagingSenderId: "852948318375",
        appId: "1:852948318375:web:609dd6544580d7d6430382"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Rastgele renk oluÅŸtur
    function randomColor() {
      const colors = ["#ff6b6b","#6bc5ff","#ffd93d","#6bff95","#b26bff"];
      return colors[Math.floor(Math.random()*colors.length)];
    }

    // Form gÃ¶nderildiÄŸinde proje ekle
    document.getElementById("projectForm").addEventListener("submit", e => {
      e.preventDefault();
      const project = {
        title: document.getElementById("title").value,
        type: document.getElementById("type").value,
        summary: document.getElementById("summary").value,
        startDate: document.getElementById("startDate").value,
        endDate: document.getElementById("endDate").value,
        offer: document.getElementById("offer").value,
        invoice: document.getElementById("invoice").value,
        purchase: document.getElementById("purchase").value,
        author: document.getElementById("author").value,
        avatarColor: randomColor(),
        status: "active",
        createdAt: new Date().toISOString()
      };
      db.ref("projects").push(project);
      e.target.reset();
    });

    // Projeleri getir
    db.ref("projects").on("value", snapshot => {
      const data = snapshot.val();
      document.getElementById("projects").innerHTML = "";
      document.getElementById("archive").innerHTML = "";

      if(!data) return;

      // Ay ay grupla
      const groups = {};
      Object.entries(data).forEach(([id, proj]) => {
        const month = proj.startDate ? proj.startDate.slice(0,7) : "DiÄŸer";
        if(!groups[month]) groups[month] = [];
        groups[month].push({id,...proj});
      });

      // Ay bazlÄ± kartlarÄ± yazdÄ±r
      Object.keys(groups).sort().reverse().forEach(month => {
        const div = document.createElement("div");
        div.className="month-group";
        div.innerHTML = `<h2>${month}</h2><div class="cards"></div>`;
        groups[month].forEach(proj => {
          const card = document.createElement("div");
          card.className="card";
          card.innerHTML = `
            <h3>${proj.title}</h3>
            <p>TÃ¼r: ${proj.type}</p>
            <div class="profile"><div class="avatar" style="background:${proj.avatarColor}"></div> ${proj.author}</div>
            <div class="details">
              <p><b>Ã–zet:</b> ${proj.summary||"-"}</p>
              <p><b>BaÅŸlangÄ±Ã§:</b> ${proj.startDate||"-"} <b>BitiÅŸ:</b> ${proj.endDate||"-"}</p>
              <p><b>Teklif:</b> ${proj.offer?`<a href="${proj.offer}" target="_blank">GÃ¶r</a>`:"-"}</p>
              <p><b>Fatura:</b> ${proj.invoice?`<a href="${proj.invoice}" target="_blank">GÃ¶r</a>`:"-"}</p>
              <p><b>SatÄ±n Alma:</b> ${proj.purchase||"-"}</p>
              <div class="notes">
                <h4>Notlar</h4>
                <div class="note-list"></div>
                <textarea class="note-input" rows="2" placeholder="Not yaz..."></textarea>
                <button class="save-note">Kaydet</button>
              </div>
            </div>
          `;
          // Kart aÃ§/kapa
          card.addEventListener("click", e=>{
            if(e.target.classList.contains("save-note")) return;
            card.querySelector(".details").style.display =
              card.querySelector(".details").style.display==="block"?"none":"block";
          });
          // Not ekle
          card.querySelector(".save-note").addEventListener("click",()=>{
            const text = card.querySelector(".note-input").value.trim();
            if(!text) return;
            const note = {
              ekleyen: proj.author,
              tarih: new Date().toLocaleString(),
              icerik: text
            };
            db.ref("projects/"+proj.id+"/notes").push(note);
            card.querySelector(".note-input").value="";
          });
          // NotlarÄ± getir
          if(proj.notes){
            Object.values(proj.notes).forEach(n=>{
              const div = document.createElement("div");
              div.className="note";
              div.textContent = `${n.tarih} - ${n.ekleyen}: ${n.icerik}`;
              card.querySelector(".note-list").appendChild(div);
            });
          }
          div.querySelector(".cards").appendChild(card);
        });
        document.getElementById("projects").appendChild(div);
      });

      // ArÅŸiv (tamamlanan/beklemede)
      Object.entries(data).forEach(([id, proj])=>{
        if(proj.status!=="active"){
          const p=document.createElement("p");
          p.textContent=`${proj.title} (${proj.status})`;
          document.getElementById("archive").appendChild(p);
        }
      });
    });
  </script>
</body>
</html>

